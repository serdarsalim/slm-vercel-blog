<!DOCTYPE html>
<html>
<head>
  <title>API Authentication Test</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    button { padding: 10px 16px; background: #4c84ff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    pre { background: #f5f5f5; padding: 15px; border-radius: 4px; overflow: auto; }
    .error { color: red; }
    .success { color: green; }
  </style>
</head>
<body>
  <h2>API Authentication Test</h2>
  <p>Testing connection to your authentication endpoint</p>
  
  <div>
    <button onclick="testAPI('authorToken')">Test with authorToken parameter</button>
    <button onclick="testAPI('api_token')">Test with api_token parameter</button>
  </div>
  
  <h3>Result:</h3>
  <pre id="result">Click a button to test...</pre>

  <script>
    async function testAPI(tokenParamName) {
      const result = document.getElementById('result');
      result.textContent = `Sending request with ${tokenParamName} parameter...`;
      result.className = '';
      
      // Parameters
      const handle = 'TBH';
      const token = '55a9855c032ca6bd7ee540cff62afb535e14598e664c31371c63d9d32ec2e2ac';

      // Create payload with selected parameter name
      const payload = { handle };
      payload[tokenParamName] = token;
      
      try {
        console.log(`Testing with payload:`, payload);
        
        const response = await fetch('/api/author/authenticate', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(payload)
        });
        
        const responseText = await response.text();
        let outputText = `Status: ${response.status}\n${responseText}`;
        
        try {
          // Try to parse as JSON for pretty display
          const data = JSON.parse(responseText);
          outputText = `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`;
          
          if (data.success) {
            result.className = 'success';
          } else {
            result.className = 'error';
          }
        } catch (e) {
          // Show warning if not valid JSON
          outputText += "\n\nWarning: Response is not valid JSON";
        }
        
        result.textContent = outputText;
      } catch (e) {
        console.error('Fetch error:', e);
        result.textContent = `Error: ${e.message}\n\nTip: Check your browser console for details`;
        result.className = 'error';
      }
    }
  </script>
</body>
</html>